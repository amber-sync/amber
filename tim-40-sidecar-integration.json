{
  "title": "Rust Sidecar Full Integration & Universal Build Pipeline",
  "description": "# Objective\nCompletely integrate the Rust sidecar for all performance-critical filesystem operations and establish a robust, automated build pipeline for universal macOS distribution.\n\n# 1. Rust Sidecar Integration Completion (Core Logic)\n*   **Replace Node.js `fs` calls:** Review `electron/main.ts` and `electron/rsync-service.ts` for direct Node.js `fs` usage that involves recursive directory traversal or large file enumerations. Replace these with calls to the Rust sidecar's `scan` or `search` commands via `FileService.ts`.\n    *   **Priority:** High. Ensure all heavy file system operations leverage the Rust sidecar.\n*   **Optimize Sandbox Creation:** Consider offloading `createSandboxDirs` (generating dummy files) to the Rust sidecar for speed and consistency, especially for large test datasets.\n\n# 2. Universal Rust Sidecar Build Automation\n*   **GitHub Actions Workflow:** Create/update `.github/workflows/build.yml` to:\n    *   Compile `amber-sidecar` for both `x86_64-apple-darwin` (Intel) and `aarch64-apple-darwin` (Apple Silicon) during CI.\n    *   Use `lipo` to combine the architecture-specific binaries into a single universal binary (e.g., `amber-sidecar-universal`).\n*   **Electron Builder Integration:** Update `package.json`'s `build` configuration to:\n    *   Ensure the universal `amber-sidecar` binary is correctly bundled and placed in `process.resourcesPath` within the final Electron app (`.dmg`/`.app`).\n    *   Adjust the `extraResources` path to point to the universal binary output.\n\n# 3. Automated Benchmarking & Performance Tracking\n*   **Performance Baseline:** Document the current 1,000,000-file search benchmark (32.04s, 31k files/s) as the baseline in `PERFORMANCE.md`.\n*   **CI Benchmarking:** Integrate `scripts/bench-rust.js` into GitHub Actions to run a comprehensive benchmark (e.g., 100k, 1M files) on every pull request or nightly build. This will detect performance regressions early.\n*   **Reporting:** Output benchmark results in a structured format (e.g., JSON) that can be easily consumed by CI for tracking performance regressions.\n*   **Continuous Benchmarking:** (Optional, stretch goal) Integrate performance metrics into GitHub Actions to track speed over time.\n\n# 4. Website Download & Distribution\n*   **Release Asset Upload:** Configure GitHub Actions to upload the generated universal `.dmg` (from Electron Builder) to GitHub Releases upon a successful tag/release.\n*   **Website Update:** Integrate with the `website/` (Next.js) project to dynamically fetch and display links to the latest universal `.dmg` from GitHub Releases.\n\n# Benchmarking Data (1,000,000 Files)\n**Files:** 1,000,000\n**Time:** 32.04 seconds\n**Speed:** ~31,214 files/s\n**Data:** ~156 MB JSON streamed\n\n# Acceptance Criteria\n*   The Electron application's filesystem operations (especially the File Browser) consistently use the Rust sidecar.\n*   Automated CI builds produce universal macOS application bundles with the Rust sidecar correctly integrated.\n*   Performance benchmarks are run automatically in CI, and any significant regressions are flagged.\n*   Users can download the universal macOS app directly from the website, with correct versions for Intel and Apple Silicon."
}